"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lambda = require("@aws-cdk/aws-lambda");
const s3 = require("@aws-cdk/aws-s3");
const core_1 = require("@aws-cdk/core");
const lib_1 = require("../lib");
const render_data_1 = require("../lib/render-data");
test('simple string', () => {
    const stack = new core_1.Stack();
    expect(render_data_1.renderData(stack, 'foo')).toStrictEqual({
        markers: {},
        text: 'foo',
    });
});
test('string with a "Ref" token', () => {
    const stack = new core_1.Stack();
    const bucket = new s3.Bucket(stack, 'Bucket');
    expect(render_data_1.renderData(stack, `foo-${bucket.bucketName}`)).toStrictEqual({
        text: 'foo-<<marker:0xbaba:0>>',
        markers: { '<<marker:0xbaba:0>>': { Ref: 'Bucket83908E77' } },
    });
});
test('string is a single "Ref" token', () => {
    const stack = new core_1.Stack();
    const bucket = new s3.Bucket(stack, 'Bucket');
    expect(render_data_1.renderData(stack, bucket.bucketName)).toStrictEqual({
        text: '<<marker:0xbaba:0>>',
        markers: { '<<marker:0xbaba:0>>': { Ref: 'Bucket83908E77' } },
    });
});
test('string is a single "Fn::GetAtt" token', () => {
    const stack = new core_1.Stack();
    const bucket = new s3.Bucket(stack, 'Bucket');
    expect(render_data_1.renderData(stack, bucket.bucketRegionalDomainName)).toStrictEqual({
        text: '<<marker:0xbaba:0>>',
        markers: { '<<marker:0xbaba:0>>': { 'Fn::GetAtt': ['Bucket83908E77', 'RegionalDomainName'] } },
    });
});
test('string with a "Fn::GetAtt" token', () => {
    const stack = new core_1.Stack();
    const bucket = new s3.Bucket(stack, 'Bucket');
    expect(render_data_1.renderData(stack, `foo-${bucket.bucketArn}`)).toStrictEqual({
        text: 'foo-<<marker:0xbaba:0>>',
        markers: { '<<marker:0xbaba:0>>': { 'Fn::GetAtt': ['Bucket83908E77', 'Arn'] } },
    });
});
test('multiple markers', () => {
    const stack = new core_1.Stack();
    const bucket = new s3.Bucket(stack, 'Bucket');
    expect(render_data_1.renderData(stack, `boom-${bucket.bucketName}-bam-${bucket.bucketArn}`)).toStrictEqual({
        text: 'boom-<<marker:0xbaba:0>>-bam-<<marker:0xbaba:1>>',
        markers: {
            '<<marker:0xbaba:0>>': { Ref: 'Bucket83908E77' },
            '<<marker:0xbaba:1>>': { 'Fn::GetAtt': ['Bucket83908E77', 'Arn'] },
        },
    });
});
test('json-encoded string', () => {
    const stack = new core_1.Stack();
    const bucket = new s3.Bucket(stack, 'Bucket');
    const json = {
        BucketArn: bucket.bucketArn,
        BucketName: bucket.bucketName,
    };
    expect(render_data_1.renderData(stack, JSON.stringify(json))).toStrictEqual({
        text: JSON.stringify({ BucketArn: '<<marker:0xbaba:0>>', BucketName: '<<marker:0xbaba:1>>' }),
        markers: {
            '<<marker:0xbaba:0>>': { 'Fn::GetAtt': ['Bucket83908E77', 'Arn'] },
            '<<marker:0xbaba:1>>': { Ref: 'Bucket83908E77' },
        },
    });
});
test('markers are returned in the source config', () => {
    const stack = new core_1.Stack();
    const handler = new lambda.Function(stack, 'Handler', { runtime: lambda.Runtime.NODEJS_14_X, code: lambda.Code.fromInline('foo'), handler: 'index.handler' });
    const actual = lib_1.Source.data('file1.txt', `boom-${stack.account}`).bind(stack, { handlerRole: handler.role });
    expect(actual.markers).toStrictEqual({
        '<<marker:0xbaba:0>>': { Ref: 'AWS::AccountId' },
    });
});
test('lazy string which can be fully resolved', () => {
    const stack = new core_1.Stack();
    expect(render_data_1.renderData(stack, core_1.Lazy.string({ produce: () => 'resolved!' }))).toStrictEqual({
        text: 'resolved!',
        markers: {},
    });
});
test('lazy within a string which can be fully resolved', () => {
    const stack = new core_1.Stack();
    const token = core_1.Lazy.string({ produce: () => 'resolved!' });
    expect(render_data_1.renderData(stack, `hello, ${token}`)).toStrictEqual({
        text: 'hello, resolved!',
        markers: {},
    });
});
test('lazy string which resolves to something with a deploy-time value', () => {
    const stack = new core_1.Stack();
    const token = core_1.Lazy.string({ produce: () => 'resolved!' });
    expect(render_data_1.renderData(stack, `hello, ${token}`)).toStrictEqual({
        text: 'hello, resolved!',
        markers: {},
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGVudC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29udGVudC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsOENBQThDO0FBQzlDLHNDQUFzQztBQUN0Qyx3Q0FBNEM7QUFDNUMsZ0NBQWdDO0FBQ2hDLG9EQUFnRDtBQUVoRCxJQUFJLENBQUMsZUFBZSxFQUFFLEdBQUcsRUFBRTtJQUN6QixNQUFNLEtBQUssR0FBRyxJQUFJLFlBQUssRUFBRSxDQUFDO0lBQzFCLE1BQU0sQ0FBQyx3QkFBVSxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQztRQUM3QyxPQUFPLEVBQUUsRUFBRTtRQUNYLElBQUksRUFBRSxLQUFLO0tBQ1osQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO0lBQ3JDLE1BQU0sS0FBSyxHQUFHLElBQUksWUFBSyxFQUFFLENBQUM7SUFDMUIsTUFBTSxNQUFNLEdBQUcsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FBQztJQUU5QyxNQUFNLENBQUMsd0JBQVUsQ0FBQyxLQUFLLEVBQUUsT0FBTyxNQUFNLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQztRQUNsRSxJQUFJLEVBQUUseUJBQXlCO1FBQy9CLE9BQU8sRUFBRSxFQUFFLHFCQUFxQixFQUFFLEVBQUUsR0FBRyxFQUFFLGdCQUFnQixFQUFFLEVBQUU7S0FDOUQsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUM7QUFFSCxJQUFJLENBQUMsZ0NBQWdDLEVBQUUsR0FBRyxFQUFFO0lBQzFDLE1BQU0sS0FBSyxHQUFHLElBQUksWUFBSyxFQUFFLENBQUM7SUFDMUIsTUFBTSxNQUFNLEdBQUcsSUFBSSxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsQ0FB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QUcsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQztRQUNuRixJQUFJLEVBQUUsV0FBVztRQUNqQixPQUFPLEVBQUUsRUFBRztLQUNiLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDO0FBRUgsSUFBSSxDQUFDLGtEQUFrRCxFQUFFLEdBQUcsRUFBRTtJQUM1RCxNQUFNLEtBQUssR0FBRyxJQUFJLFlBQUssRUFBRSxDQUFDO0lBQzFCLE1BQU0sS0FBSyxHQUFHLFdBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztJQUUxRCxNQUFNLENBQUMsd0JBQVUsQ0FBQyxLQUFLLEVBQUUsVUFBVSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDO1FBQ3pELElBQUksRUFBRSxrQkFBa0I7UUFDeEIsT0FBTyxFQUFFLEVBQUc7S0FDYixDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQztBQUVILElBQUksQ0FBQyxrRUFBa0UsRUFBRSxHQUFHLEVBQUU7SUFDNUUsTUFBTSxLQUFLLEdBQUcsSUFBSSxZQUFLLEVBQUUsQ0FBQztJQUMxQixNQUFNLEtBQUssR0FBRyxXQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7SUFFMUQsTUFBTSxDQUFDLHdCQUFVLENBQUMsS0FBSyxFQUFFLFVBQVUsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQztRQUN6RCxJQUFJLEVBQUUsa0JBQWtCO1FBQ3hCLE9BQU8sRUFBRSxFQUFHO0tBQ2IsQ0FBQyxDQUFDO0FBRUwsQ0FBQyxDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBsYW1iZGEgZnJvbSAnQGF3cy1jZGsvYXdzLWxhbWJkYSc7XG5pbXBvcnQgKiBhcyBzMyBmcm9tICdAYXdzLWNkay9hd3MtczMnO1xuaW1wb3J0IHsgTGF6eSwgU3RhY2sgfSBmcm9tICdAYXdzLWNkay9jb3JlJztcbmltcG9ydCB7IFNvdXJjZSB9IGZyb20gJy4uL2xpYic7XG5pbXBvcnQgeyByZW5kZXJEYXRhIH0gZnJvbSAnLi4vbGliL3JlbmRlci1kYXRhJztcblxudGVzdCgnc2ltcGxlIHN0cmluZycsICgpID0+IHtcbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgZXhwZWN0KHJlbmRlckRhdGEoc3RhY2ssICdmb28nKSkudG9TdHJpY3RFcXVhbCh7XG4gICAgbWFya2Vyczoge30sXG4gICAgdGV4dDogJ2ZvbycsXG4gIH0pO1xufSk7XG5cbnRlc3QoJ3N0cmluZyB3aXRoIGEgXCJSZWZcIiB0b2tlbicsICgpID0+IHtcbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgY29uc3QgYnVja2V0ID0gbmV3IHMzLkJ1Y2tldChzdGFjaywgJ0J1Y2tldCcpO1xuXG4gIGV4cGVjdChyZW5kZXJEYXRhKHN0YWNrLCBgZm9vLSR7YnVja2V0LmJ1Y2tldE5hbWV9YCkpLnRvU3RyaWN0RXF1YWwoe1xuICAgIHRleHQ6ICdmb28tPDxtYXJrZXI6MHhiYWJhOjA+PicsXG4gICAgbWFya2VyczogeyAnPDxtYXJrZXI6MHhiYWJhOjA+Pic6IHsgUmVmOiAnQnVja2V0ODM5MDhFNzcnIH0gfSxcbiAgfSk7XG59KTtcblxudGVzdCgnc3RyaW5nIGlzIGEgc2luZ2xlIFwiUmVmXCIgdG9rZW4nLCAoKSA9PiB7XG4gIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gIGNvbnN0IGJ1Y2tldCA9IG5ldyBzMy5CdWNrZXQoc3RhY2ssICdCdWNrZXQnKTtcblxuICBleHBlY3QocmVuZGVyRGF0YShzdGFjaywgYnVja2V0LmJ1Y2tldE5hbWUpKS50b1N0cmljdEVxdWFsKHtcbiAgICB0ZXh0OiAnPDxtYXJrZXI6MHhiYWJhOjA+PicsXG4gICAgbWFya2VyczogeyAnPDxtYXJrZXI6MHhiYWJhOjA+Pic6IHsgUmVmOiAnQnVja2V0ODM5MDhFNzcnIH0gfSxcbiAgfSk7XG59KTtcblxudGVzdCgnc3RyaW5nIGlzIGEgc2luZ2xlIFwiRm46OkdldEF0dFwiIHRva2VuJywgKCkgPT4ge1xuICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICBjb25zdCBidWNrZXQgPSBuZXcgczMuQnVja2V0KHN0YWNrLCAnQnVja2V0Jyk7XG5cbiAgZXhwZWN0KHJlbmRlckRhdGEoc3RhY2ssIGJ1Y2tldC5idWNrZXRSZWdpb25hbERvbWFpbk5hbWUpKS50b1N0cmljdEVxdWFsKHtcbiAgICB0ZXh0OiAnPDxtYXJrZXI6MHhiYWJhOjA+PicsXG4gICAgbWFya2VyczogeyAnPDxtYXJrZXI6MHhiYWJhOjA+Pic6IHsgJ0ZuOjpHZXRBdHQnOiBbJ0J1Y2tldDgzOTA4RTc3JywgJ1JlZ2lvbmFsRG9tYWluTmFtZSddIH0gfSxcbiAgfSk7XG59KTtcblxudGVzdCgnc3RyaW5nIHdpdGggYSBcIkZuOjpHZXRBdHRcIiB0b2tlbicsICgpID0+IHtcbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgY29uc3QgYnVja2V0ID0gbmV3IHMzLkJ1Y2tldChzdGFjaywgJ0J1Y2tldCcpO1xuXG4gIGV4cGVjdChyZW5kZXJEYXRhKHN0YWNrLCBgZm9vLSR7YnVja2V0LmJ1Y2tldEFybn1gKSkudG9TdHJpY3RFcXVhbCh7XG4gICAgdGV4dDogJ2Zvby08PG1hcmtlcjoweGJhYmE6MD4+JyxcbiAgICBtYXJrZXJzOiB7ICc8PG1hcmtlcjoweGJhYmE6MD4+JzogeyAnRm46OkdldEF0dCc6IFsnQnVja2V0ODM5MDhFNzcnLCAnQXJuJ10gfSB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCdtdWx0aXBsZSBtYXJrZXJzJywgKCkgPT4ge1xuICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICBjb25zdCBidWNrZXQgPSBuZXcgczMuQnVja2V0KHN0YWNrLCAnQnVja2V0Jyk7XG5cbiAgZXhwZWN0KHJlbmRlckRhdGEoc3RhY2ssIGBib29tLSR7YnVja2V0LmJ1Y2tldE5hbWV9LWJhbS0ke2J1Y2tldC5idWNrZXRBcm59YCkpLnRvU3RyaWN0RXF1YWwoe1xuICAgIHRleHQ6ICdib29tLTw8bWFya2VyOjB4YmFiYTowPj4tYmFtLTw8bWFya2VyOjB4YmFiYToxPj4nLFxuICAgIG1hcmtlcnM6IHtcbiAgICAgICc8PG1hcmtlcjoweGJhYmE6MD4+JzogeyBSZWY6ICdCdWNrZXQ4MzkwOEU3NycgfSxcbiAgICAgICc8PG1hcmtlcjoweGJhYmE6MT4+JzogeyAnRm46OkdldEF0dCc6IFsnQnVja2V0ODM5MDhFNzcnLCAnQXJuJ10gfSxcbiAgICB9LFxuICB9KTtcbn0pO1xuXG50ZXN0KCdqc29uLWVuY29kZWQgc3RyaW5nJywgKCkgPT4ge1xuICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICBjb25zdCBidWNrZXQgPSBuZXcgczMuQnVja2V0KHN0YWNrLCAnQnVja2V0Jyk7XG4gIGNvbnN0IGpzb24gPSB7XG4gICAgQnVja2V0QXJuOiBidWNrZXQuYnVja2V0QXJuLFxuICAgIEJ1Y2tldE5hbWU6IGJ1Y2tldC5idWNrZXROYW1lLFxuICB9O1xuXG4gIGV4cGVjdChyZW5kZXJEYXRhKHN0YWNrLCBKU09OLnN0cmluZ2lmeShqc29uKSkpLnRvU3RyaWN0RXF1YWwoe1xuICAgIHRleHQ6IEpTT04uc3RyaW5naWZ5KHsgQnVja2V0QXJuOiAnPDxtYXJrZXI6MHhiYWJhOjA+PicsIEJ1Y2tldE5hbWU6ICc8PG1hcmtlcjoweGJhYmE6MT4+JyB9KSxcbiAgICBtYXJrZXJzOiB7XG4gICAgICAnPDxtYXJrZXI6MHhiYWJhOjA+Pic6IHsgJ0ZuOjpHZXRBdHQnOiBbJ0J1Y2tldDgzOTA4RTc3JywgJ0FybiddIH0sXG4gICAgICAnPDxtYXJrZXI6MHhiYWJhOjE+Pic6IHsgUmVmOiAnQnVja2V0ODM5MDhFNzcnIH0sXG4gICAgfSxcbiAgfSk7XG59KTtcblxudGVzdCgnbWFya2VycyBhcmUgcmV0dXJuZWQgaW4gdGhlIHNvdXJjZSBjb25maWcnLCAoKSA9PiB7XG4gIGNvbnN0IHN0YWNrID0gbmV3IFN0YWNrKCk7XG4gIGNvbnN0IGhhbmRsZXIgPSBuZXcgbGFtYmRhLkZ1bmN0aW9uKHN0YWNrLCAnSGFuZGxlcicsIHsgcnVudGltZTogbGFtYmRhLlJ1bnRpbWUuTk9ERUpTXzE0X1gsIGNvZGU6IGxhbWJkYS5Db2RlLmZyb21JbmxpbmUoJ2ZvbycpLCBoYW5kbGVyOiAnaW5kZXguaGFuZGxlcicgfSk7XG4gIGNvbnN0IGFjdHVhbCA9IFNvdXJjZS5kYXRhKCdmaWxlMS50eHQnLCBgYm9vbS0ke3N0YWNrLmFjY291bnR9YCkuYmluZChzdGFjaywgeyBoYW5kbGVyUm9sZTogaGFuZGxlci5yb2xlISB9KTtcbiAgZXhwZWN0KGFjdHVhbC5tYXJrZXJzKS50b1N0cmljdEVxdWFsKHtcbiAgICAnPDxtYXJrZXI6MHhiYWJhOjA+Pic6IHsgUmVmOiAnQVdTOjpBY2NvdW50SWQnIH0sXG4gIH0pO1xufSk7XG5cbnRlc3QoJ2xhenkgc3RyaW5nIHdoaWNoIGNhbiBiZSBmdWxseSByZXNvbHZlZCcsICgpID0+IHtcbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcblxuICBleHBlY3QocmVuZGVyRGF0YShzdGFjaywgTGF6eS5zdHJpbmcoeyBwcm9kdWNlOiAoKSA9PiAncmVzb2x2ZWQhJyB9KSkpLnRvU3RyaWN0RXF1YWwoe1xuICAgIHRleHQ6ICdyZXNvbHZlZCEnLFxuICAgIG1hcmtlcnM6IHsgfSxcbiAgfSk7XG59KTtcblxudGVzdCgnbGF6eSB3aXRoaW4gYSBzdHJpbmcgd2hpY2ggY2FuIGJlIGZ1bGx5IHJlc29sdmVkJywgKCkgPT4ge1xuICBjb25zdCBzdGFjayA9IG5ldyBTdGFjaygpO1xuICBjb25zdCB0b2tlbiA9IExhenkuc3RyaW5nKHsgcHJvZHVjZTogKCkgPT4gJ3Jlc29sdmVkIScgfSk7XG5cbiAgZXhwZWN0KHJlbmRlckRhdGEoc3RhY2ssIGBoZWxsbywgJHt0b2tlbn1gKSkudG9TdHJpY3RFcXVhbCh7XG4gICAgdGV4dDogJ2hlbGxvLCByZXNvbHZlZCEnLFxuICAgIG1hcmtlcnM6IHsgfSxcbiAgfSk7XG59KTtcblxudGVzdCgnbGF6eSBzdHJpbmcgd2hpY2ggcmVzb2x2ZXMgdG8gc29tZXRoaW5nIHdpdGggYSBkZXBsb3ktdGltZSB2YWx1ZScsICgpID0+IHtcbiAgY29uc3Qgc3RhY2sgPSBuZXcgU3RhY2soKTtcbiAgY29uc3QgdG9rZW4gPSBMYXp5LnN0cmluZyh7IHByb2R1Y2U6ICgpID0+ICdyZXNvbHZlZCEnIH0pO1xuXG4gIGV4cGVjdChyZW5kZXJEYXRhKHN0YWNrLCBgaGVsbG8sICR7dG9rZW59YCkpLnRvU3RyaWN0RXF1YWwoe1xuICAgIHRleHQ6ICdoZWxsbywgcmVzb2x2ZWQhJyxcbiAgICBtYXJrZXJzOiB7IH0sXG4gIH0pO1xuXG59KTsiXX0=